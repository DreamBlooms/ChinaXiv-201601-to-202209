[
    {
        "type": "text",
        "text": "城市大气环境的高保真度数值模拟",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "关键词：有限元方法；并行计算；区域分解算法；",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "1引言",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "随着城市人口和工业活动的增加，我国多数一二线城市在建及规划建筑呈高层化、密集化趋势。其对大气环境最直接的影响是大幅降低城市内空气流通速度。空气停滞形成的空气穹隆促使近地逆温层的形成，将各种污染源排放的污染物笼罩，加剧城市的污染，形成高浓度的大气污染[1]。此外，城市大气环境特性的变化，如因建筑物阻挡产生的涡旋大大增多、气流的紊流性增强等，会在城市街道中产生“城市急流”或产生气流死区，对市区街道、小区等小面积区域的空气污染物扩散带来不利影响甚至造成严重污染问题[2]，同时也会使城市大气环境数值计算变得困难。",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "2 需求",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "在污染预报等环境监测领域，基于背景流场的模拟与相关部门的气象数据，求解大气污染物输运及扩散问题获取的数值结果可作为空气污染预报的重要参考资料，可用以评估大气排放的污染物对城市区域环境造成的影响。近年来，在城市突发性污染及危险事件分析及预警、城市规划等方面，大气环境的高保真度数值模拟应用越来越广。",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "1）城区突发污染事件预报与预警 ",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "快速有效地对城市大气环境进行模拟，并以此安排预报预警措施具有重大的社会和经济意义。以深圳为例，该市及周边地区突发污染事件如油库、化学品仓库等高危品爆炸，工业厂区发生火灾等时有发生。如与深圳市中心城区域接壤的香港打鼓岭垃圾回收场分别与2013年11月9日、2015年9月11日、2016年3月2日三次发生火警，大量夹杂有毒气体的黑烟飘向深圳方向，对城区的空气造成严重的污染，严重威胁市民的身体健康。基于高保真度的大气背景流场进行污染物实时扩散及输运的数值模拟，可及时对污染物在市区各区域的污染浓度做出计算，获取，为进一步的评估、预警及其他调控治理措施提供依据。",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "2）为城市布局及规划提供依据",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "为应对各大城市日趋严峻的大气污染状况，除了从源头上减轻污染源的措施外，城市风道作为治理大气污染的手段之一成为研究的热点领域。大气污染物在静稳无风、大气扩散条件差的不利气象条件下容易堆积，因此把郊外的风引进主城区，将霾等污染物吹走成为备选除霾方式之一。城市风道即城市通风廊道，通过以市区中的绿地、水面及道路等形式减少城市对风的阻挡，达到促进城区内外热交换和污染物扩散的作用，从而缓解热岛效应和空气污染。北京市政府从2014年开始分析、论证与规划通风廊道，以增强通风潜力、缓解热岛效应。据媒体报道，北京将形成5条宽度500米以上的一级通风廊道，多条宽度80米以上的二级通风廊道，未来形成通风廊道网络系统。相关研究建议，对主通风廊道区域严格规划控制，包括控制建设高度和密度等，同时打通障碍点。除北京外，上海、杭州、武汉等多个城市也开始着手规划城市风道，以应对越来越严重的大气污染问题。在城市规划过程中，模拟大气环境以及污染扩散状况可以为政府部门提供各种有价值的参考信息，合理规划建筑物的密度和高度以利于空气污染物、城市内部热量和废弃物疏散，在为城区保留安全绿色空间和保持生态格局前提下优化城市布局。",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "城区空气质量与人民生活质量息息相关，市中心区人口分布又非常密集，因此及时、准确地对城区大气环境及基于其基础上的污染预报与预警，以及以大气污染消除与控制为目的的合理的城市规划对于环境保护及市民健康意义重大，世界各国也都在积极地开展城市大气环境的研究。",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "3.研究现状与挑战",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "1) 研究现状与趋势",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "运用数值模拟技术对城市的大气环境进行模拟已经成为相关领域的研究热点。在模拟模式方面，近几十年来通过国内外相关学者的大量研究，以梯度输送、湍流统计和湍流相似扩散三种理论为基础，研究者已经建立和发展了多种大气环境模拟模式，主要有高斯模式及其变形模式、统计模式、大气扩散相似模式等。相应的大气环境模型软件也已经开发出数百种，如美国EPA的Model-3与",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "ISC-AERMOD[3]、英国CERC的ADMS[4]等。不同的扩散模式及与其相应的模型软件都有各自不同的地貌、气候、污染源等考虑因素，因而也就有各自不同的适用范围。城市大气环境模拟从模拟尺度方面可分为如下几类[5]：第一类是城市冠层模式模拟，分辨率数百至数千米，预报时间为数小时。第二类是单个到多个建筑物尺度的模拟，典型网格尺度为数米至数百米，采用CFD模式，求解时间约为数分钟至数小时。第三类为小于建筑物尺度的模拟，典型网格尺度小于一米，同样采用CFD模式，求解时间为数秒至数分钟。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "由于计算机硬件条件限制，过去大部分的研究往需要首先确定数值模拟的尺度问题，根据问题规模选择不同的模拟方法，如中尺度模拟或小尺度模拟。其中，中尺度问题虽然可极大减小计算量，牺牲仿真的精度来换取计算的可实现性，但还是简化城市下垫面建筑模型，结果相对于特定建筑单元是定性而非定量结果，因此对大气环境模拟的精度较差。采用CFD方法的小尺度污染数值模拟同样受制于计算机硬件的水平，只能获取某栋或数栋建筑物周边大气环境情况，无法与该区域整体环境相结合，因此往往准确度不高，仅在室内等较封闭空间内可以获取可置信的数值结果。近年来，城市大气环境中小尺度模拟发展趋势主要概括为以下三点：首先是模拟方案分辨率更高，能更精确表达城市地面的复杂性和相互关系，中尺度与小尺度问题紧密结合，模拟更细致、更新颖；第二是可在更大、更复杂区域实施模拟；第三结果评价更严格、更细致，可信度提高[6]。推动城市大气环境中小尺度模拟耦合相关研究发展的两个重要因素是城市人口持续增长造成的环境问题愈加严重以及计算机硬件技术的发展使数值计算能力快速增长[7]。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "2) 挑战性问题",
        "text_level": 1,
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "城市的典型尺度一般认为约 $2 0 { \\sim } 4 0 \\mathrm { k m }$ ，城市下垫面建筑群即边界层按照功能与用途可不均匀地划分成许多区域，包括市中心区、居民区、公共活动区、新建区、工业区、不同街道交通区等。一方面，整个城市的大尺度性与其中各城市单元的几何多尺度性给高保真度模拟带来巨大的计算量；另一方面，边界层结构与特性的非均匀性带来了气象及流动参数难以确定、动量、热量输运过程复杂多变等难题[8]。从计算角度考虑，城市大气环境模拟是一个典型的高雷诺数时间相关三维问题，求解区域复杂且呈几何多尺度，离散后非线性系统病态且规模巨大。高分辨率的数值结果往往需要高精度的流动模型以及高分辨率的时空网格，这些因素均带来了庞大计算量，求解时需要超强的计算机硬件与与之匹配的高性能数值算法。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "数值模拟技术的发展始终与计算机硬件发展水平紧密相关。对城市大气环境进行模拟，实质上是以气象预报和监测信息为初边值条件，对空气运动的数学方程(一般是三维非线性偏微分方程组)进行计算机求解。虽然此类数值方法已经应用多年，并已经是高性能计算最重要的应用领域之一，但由于传统的大气环境模拟并行算法及其程序优化技术不能适应目前集群处理器数目高速增长的需要，以致该领域几乎所有程序无法扩展到数千核，遑论千万亿次的数万核乃至亿亿次机的数十万、数百万核。上述原因致使目前城市大气环境数值模拟相关应用缺乏高扩展并行算法的支撑，直接导致数值模拟求解分辨率大于百米且在万亿次浮点运算量级的计算平台上展开，严重影响数值模拟的准确率。近年来天津、深圳、广州等地相继建立了国家超算中心，所采用的超级计算集群普遍采用新型架构体系，这些都对当前的通用算法技术提出了严峻的挑战。而研究适用于求解大规模非线性稀疏方程组的高可扩展并行算法与计算机硬件资源匹配已经成为工程计算领域非常重要的研究方向。因此，若获取及时、准确的污染物输运扩散数值结果，必须发展一套能够充分发挥当前计算资源，尤其是大规模并行计算平台的高效能计算优化理论和技术，使得预报程序具有高可扩展性，从而确保计算的高速、高保真度。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "4关键技术",
        "text_level": 1,
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "4.1流体控制方程及其有限元离散",
        "text_level": 1,
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "为获取高保真度的城市大气流场信息，首先需对大气流动以及所研究的市区建筑群进行建模。其次，由于流体的连续介质特性以及边界条件的影响，往往需要将建筑群置入某个封闭的计算区域 $\\Omega$ ，然后针对整个 $\\Omega$ 进行分析求解。 $\\Omega$ 的选取与计算问题有关， $\\Omega$ 必须足够大以尽量避免区域边界对建筑群附近流场的影响，同时还要兼顾整体计算量的大小。最后，市区大气流动可视为不压缩Newton流，可采用三维非定常不可压Navier-Stokes方程描述：",
        "page_idx": 1
    },
    {
        "type": "image",
        "img_path": "images/71fed668e6590366ccb084b5497b43e4eae8ddc6e041c93c12fb0ff8c14bb234.jpg",
        "img_caption": [],
        "img_footnote": [],
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "其中 $\\rho$ 、 $p$ 及 $\\mu$ 分别为空气密度、压力和动力粘度系数， $\\mathbf { u } { = } \\mathcal { ( } \\mathcal { W } \\mathbf { , } W \\mathbf { ) }$ 为速度向量， $a = 1 1 + 2 \\mu$ 为柯西压力张量，其中，为特征张量，。该连续方程及动量守恒方程由初始条件：",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "以及边界条件：",
        "page_idx": 2
    },
    {
        "type": "equation",
        "text": "$$\n\\begin{array} { l l } { \\mathbf { u } } & { \\mathbf { \\equiv } \\mathbf { g } \\mathbf { \\equiv } \\mathbf { \\Phi } _ { \\mathbf { { o n } } } \\quad \\mathbf { \\equiv } \\mathbf { \\Psi } _ { \\mathbf { { o z t } } } } \\\\ { \\mathbf { u } } & { \\mathbf { \\equiv } \\mathbf { \\Theta } \\mathbf { \\Phi } _ { \\mathbf { { o n } } } \\quad \\mathbf { \\equiv } \\mathbf { \\Psi } _ { \\mathbf { { h a r } } } } \\\\ { \\mathbf { \\qquad } \\mathbf { \\qquad } \\mathbf { \\qquad } \\mathbf { \\qquad } \\mathbf { \\qquad } \\mathbf { \\qquad } } \\end{array} ,\n$$",
        "text_format": "latex",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "约束，其中 $\\Gamma _ { i n l e t }$ 为速度进口边界， $\\Gamma _ { w a l l }$ 为城市建筑群落及计算区域边界，设为无滑移壁面边界， $\\Gamma _ { o u t l e t }$ 为采用远场边界条件即自由出流边界， $\\mathbf { g }$ 为进口边界条件给定的风速。在计算实际问题时，边界条件由气象及环保部门提供的实时监测数据选定。城市建筑群几何模型可根据GIS技术、点云建模技术以及其他建模方法获取。如图一所示，实际模拟中，处理几何模型相当繁琐，为获取高保真度数值结果，往往需要将地形地势考虑在内，其工作量可占整体模拟时间的 $6 0 \\%$ 以上。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "#山 mun 中临 t ",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "为了获取流体流动数值解，数值模拟技术是通过将控制偏微分方程按照某种离散格式离散，然后转化为各个计算节点上的代数方程组，最后求解得到各节点上的值来获取整体流场的近似解，因此离散化与代数化是数值计算的前提。对于本文的瞬态问题，偏微分方程的离散在空间和时间上都有体现，选取合适的时空离散格式对后续求解算法有重要影响。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "空间离散格式方面，考虑到高阶的有限元在离散化后所形成的矩阵非零元素过多从而影响算法整体的并行可扩展性，结合并行计算的特点，我们采用低阶的 $P _ { 1 } - P _ { 1 }$ 有限元格式对空间进行离散。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "通过对计算区域 $\\Omega$ 进行剖分得到非结构四面体网格 $T ^ { h } = \\{ K \\}$ ，定义测试函数及权函数空间：$\\mathcal { U } = \\{ \\mathbf { u } ( \\cdot , t ) ~ | ~ \\mathbf { u } ( \\cdot , t ) \\in [ H ^ { 1 } ( \\Omega ) ] ^ { 3 } , \\quad \\mathbf { u } ( \\cdot , t ) = \\mathbf { g }$ on $\\Gamma _ { i n l e t } \\}$ U $= \\{ \\mathbf { u } ( \\cdot , t ) ~ | ~ \\mathbf { u } ( \\cdot , t ) \\in [ H ^ { 1 } ( \\Omega ) ] ^ { 3 } , \\quad \\mathbf { u } ( \\cdot , t ) = \\mathbf { 0 } \\quad \\mathrm { o n } \\quad \\Gamma _ { i n l e t } \\cup \\Gamma _ { w a l l } \\}$ $\\mathcal { P } = \\{ p ( \\cdot , t ) ~ | ~ p ( \\cdot , t ) \\in L ^ { 2 } ( \\Omega ) \\} _ { \\mathfrak { c } }$ ",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "Navier-Stokes方程（1）的弱形式可描述为寻求$\\mathbf { u } \\in \\mathcal { U }$ 及 $p \\in \\mathcal P$ 使得所有 $\\Phi \\in \\mathcal { U } _ { 0 }$ ， $\\varphi \\in \\mathcal P$ 满足：",
        "page_idx": 2
    },
    {
        "type": "equation",
        "text": "$$\n\\begin{array} { r l } & { \\rho \\int _ { \\Omega } \\frac { \\partial \\mathbf { u } } { \\partial t } \\cdot \\Phi d \\Omega + \\mu \\int _ { \\Omega } \\nabla \\mathbf { u } : \\nabla \\Phi d \\Omega + \\rho \\int _ { \\Omega } ( \\mathbf { u } \\cdot \\nabla ) \\mathbf { u } \\cdot \\Phi d \\Omega } \\\\ & { - \\int _ { \\Omega } p \\nabla \\cdot \\Phi d \\Omega + \\int _ { \\Omega } ( \\nabla \\cdot \\mathbf { u } ) \\varphi d \\Omega = \\int _ { \\Omega } \\mathbf { f } \\cdot \\Phi d \\Omega } \\end{array}\n$$",
        "text_format": "latex",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "有限维试函数及全函数空间可以表示为：",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "$\\begin{array} { r } { \\mathcal { U } ^ { h } = \\{ \\mathbf { u } ^ { h } ( \\cdot , t ) ~ | ~ \\mathbf { u } ^ { h } ( \\cdot , t ) = \\sum _ { i = 1 } ^ { N _ { u } } \\Phi _ { i } ^ { h } \\mathbf { u } _ { i } ^ { h } ( \\cdot , t ) , ~ \\mathbf { u } ^ { h } ( \\cdot , t ) = \\mathbf { g } ~ \\mathrm { o n } ~ \\Gamma _ { i n l e t } \\} } \\end{array}$ u= $\\begin{array} { r } { \\{ \\mathbf { u } ^ { h } ( \\cdot , t ) ~ | ~ \\mathbf { u } ^ { h } ( \\cdot , t ) = \\sum _ { i = 1 } ^ { N _ { u } } \\Phi _ { i } ^ { h } \\mathbf { u } _ { i } ^ { h } ( \\cdot , t ) , ~ \\mathbf { u } ^ { h } ( \\cdot , t ) = \\mathbf { 0 } ~ \\mathrm { o n } ~ \\Gamma _ { i n l e t } \\cup \\Gamma _ { w a l l } } \\end{array}$ $\\begin{array} { r } { \\mathcal { P } ^ { h } = \\{ p ^ { h } ( \\cdot , t ) ~ | ~ p ^ { h } ( \\cdot , t ) = \\sum _ { i = 1 } ^ { N _ { p } } \\varphi _ { i } ^ { h } p _ { i } ^ { h } ( \\cdot , t ) \\} _ { \\circ } } \\end{array}$ ",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "其中 $N _ { u } , \\ N _ { p }$ 为速度与压力的总节点数， ${ \\bf u } _ { i } ^ { h } \\in {  R } ^ { 3 }$ ， $p _ { i } ^ { h } \\in R$ 为节点处速度与压力值。由于 $P _ { 1 } - P _ { 1 }$ 元不满足Ladyzenskaja-Babuska-Brezzi（LBB）条件，因此，通过添加适当的稳定项[9，空间离散有限元系统可表示为：",
        "page_idx": 2
    },
    {
        "type": "equation",
        "text": "$$\n\\begin{array} { r l } & { \\rho \\int _ { \\Omega } \\frac { \\partial \\mathbf { u } ^ { h } } { \\partial t } \\cdot \\Phi ^ { h } d \\Omega + \\mu \\int _ { \\Omega } \\nabla \\mathbf { u } ^ { h } : \\nabla \\Phi ^ { h } d \\Omega + \\rho \\int _ { \\Omega } ( \\mathbf { u } ^ { h } \\cdot \\nabla ) \\mathbf { u } ^ { h } \\cdot \\Phi ^ { h } d \\Omega } \\\\ & { - \\int _ { \\Omega } p ^ { h } \\nabla \\cdot \\Phi ^ { h } d \\Omega + \\int _ { \\Omega } ( \\nabla \\cdot \\mathbf { u } ^ { h } ) \\varphi ^ { h } d \\Omega + \\sum _ { K \\in \\mathcal { T } ^ { h } } \\left( \\nabla \\cdot \\mathbf { u } ^ { h } , \\tau _ { c } \\nabla \\cdot \\Phi ^ { h } \\right) _ { K } } \\\\ & { \\sum _ { K \\in \\mathcal { T } ^ { h } } \\left( \\frac { \\partial \\mathbf { u } ^ { h } } { \\partial t } + ( \\mathbf { u } ^ { h } \\cdot \\nabla ) \\mathbf { u } ^ { h } + \\nabla p ^ { h } , \\tau _ { m } ( \\mathbf { u } ^ { h } \\cdot \\nabla \\Phi ^ { h } + \\nabla \\varphi ^ { h } ) \\right) _ { K } } \\\\ & { = \\int _ { \\Omega } \\mathbf { f } \\cdot \\Phi ^ { h } d \\Omega + \\sum _ { K \\in \\mathcal { T } ^ { h } } \\left( \\mathbf { f } , \\tau _ { m } ( \\mathbf { u } ^ { h } \\cdot \\nabla \\Phi ^ { h } + \\nabla \\varphi ^ { h } ) \\right) _ { K } } \\end{array}\n$$",
        "text_format": "latex",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "时间项方面，本文采用了全隐时间格式离散进行离散。全隐格式由于减轻甚至消除了CFL条件对时间步长的限制，在进行大规模数值计算时具有一定优势。具体地，针对上述不可压Navier-Stokes方程，选取隐式向后Euler有限差分格式对时间项离散，即将控制方程（1）离散为如下非线性代数方程：",
        "page_idx": 2
    },
    {
        "type": "equation",
        "text": "$$\n\\begin{array} { r } { \\frac { x ^ { n } - x ^ { n - 1 } } { \\Delta t } = S ( x ^ { n } ) } \\end{array}\n$$",
        "text_format": "latex",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "其中 $\\Delta t$ 为时间步长， $S ( x ^ { n } )$ 为在第 $\\mathbf { \\dot { \\Omega } } _ { n }$ 时间步经空间离散后形成的半离散系统。至此，问题化解为在每个时间步求解非线性方程组：",
        "page_idx": 2
    },
    {
        "type": "equation",
        "text": "$$\nF ^ { n } ( x ^ { n } ) = 0\n$$",
        "text_format": "latex",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "4.2并行Newton-Krylov-Schwarz算法",
        "text_level": 1,
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "包括城市大气环境流场计算等问题在内，计算流体力学技术的核心是求解流体控制方程经有限元等方法离散后所形成的稀疏方程组。计算精度要求提高、城区下垫面建筑建模精细化、多尺度以及大雷诺数对流占优等特点，使得该稀疏方程组的规模十分巨大且伴随着强烈的非线性，求解异常困难。具体到城市大气环境模拟问题，在每个时间步内，经有限元离散后形成的系统（3）规模十分巨大且由于对流占优而具有很强的非线性。求解此类大规模的病态问题时，一般均需借助大型并行计算机及相应的可扩展性算法进行求解。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "目前非线性方程组线性化方法中最常用且有效的是Newton 型方法。其中非精确Newton方法虽然需要求解原始的Jacobian矩阵，但是却不需要精确求解，可通过求解精度来达到计算量与收敛速度的平衡。在线性求解器方面，由于直接法求解大规模线性方程组对计算机内存及速度要求过高而不现实，因此目前使用迭代法求解大规模非线性系统几乎成为唯一选择。本文基于Krylov子空间的迭代方法构造线性求解器。上述两种方法结合为Newton-Krylov迭代法，该方法的核心是在每个非线性迭代步通过采用Krylov子空间迭代法求解一个雅可比线性方程组从而获得Newton 增量。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "无论在线性、非线性迭代法中，预条件子都起到加速收敛的作用，在数值算法构造中占据重要地位。其作用是以较低的额外代价换取迭代次数的大幅降低和求解时间的有效减少，预条件子的构造往往依赖于所研究的物理问题[9」，对预条件子的改进是提高整个数值算法性能的关键。区域分解方法既可以作为迭代法也更适合于作为其他高效迭代求解器的预条件子，尤其适合于当前流行的分布式并行计算机环境。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "基于上述方法，本文提出了适用于求解城市大气背景流场问题的Newton-Krylov-Schwarz（NKS）算法。使用非精确Newton算法作为非线性求解器，在每个非精确Newton 步里使用由基于区域分解方法的Schwarz预处理算子来加速Krylov算法求解Jacobian方程。其详细步骤列举如下：",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "NKS算法: ",
        "text_level": 1,
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "步骤1：使用前一个时间步的解作为初始值$\\mathbf { X } _ { 0 } ^ { n } = \\mathbf { X } ^ { n - 1 } ,$ 步骤2：对 $\\cdot k = 0 , 1 , \\cdots$ 执行以下步骤，直至收敛，步骤2.1：构造Jacobian矩阵 $\\mathbf { J } _ { k } ^ { n }$ 步骤2.2：采用带有预处理的Krylov子空间方法（如GMRES）非精确求解如下Jacobian系统$\\begin{array} { r } { { \\bf J } _ { k } ^ { n } ( { \\bf M } _ { k } ^ { n } ) ^ { - 1 } { \\bf M } _ { k } ^ { n } { \\bf S } _ { k } ^ { n } = - { \\bf F } ^ { n } ( { \\bf X } _ { k } ^ { n } ) , } \\end{array}$ （204步骤2.3：通过线性搜索获得步长 $\\tau _ { k } ^ { n }$ 步骤2.4：更新迭代解（204号 $\\mathbf { X } _ { k + 1 } ^ { n } = \\mathbf { X } _ { k } ^ { n } + \\tau _ { k } ^ { n } \\mathbf { S } _ { k _ { \\circ } } ^ { n }$ （20在此步骤中， $\\mathbf { J } _ { k } ^ { n }$ 为待求非线性方程组 $\\mathbf { F } ^ { n } ( \\mathbf { X } )$ 在点 $\\mathbf { X } _ { k } ^ { n }$ 处的全 Jacobian 矩阵， $\\mathbf { M } _ { k _ { - } } ^ { n }$ 为一水平加性 Schwarz 预条件算子，步骤 2.2 中非精确是指求解Jacobian系统时满足如下条件即可：",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "$\\parallel \\mathbf { J } _ { k } ^ { n } ( \\mathbf { M } _ { k } ^ { n } ) ^ { - 1 } \\mathbf { M } _ { k } ^ { n } \\mathbf { S } _ { k } ^ { n } + \\mathbf { F } ^ { n } ( \\mathbf { X } _ { k } ^ { n } ) \\parallel \\leq \\eta _ { k } ^ { n } \\parallel \\mathbf { F } ^ { n } ( \\mathbf { X } _ { k } ^ { n } ) \\parallel$ 式中 $\\eta _ { k } ^ { n }$ 为线性求解器的相对收敛误差。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "在本研究中，我们使用该算法求解3.2节中控制方程离散后形成的非线性系统（3）。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "本章介绍的算法基于阿贡国家实验室开发的开源可移植并行软件包PETSc[10]实现。PETSc基于基础线性代数子程序库（BLAS)，线性代数包LAPACK以及消息传递接口库MPI等构成线性求解器、非线性求解器以及时间步进积分器三个主要的组件，为用户提供了包括求解大规模稀疏线性方程组的多种Krylov子空间方法在内的丰富的算法以及预条件子，在高性能计算平台上具有强大的偏微分方程数值求解能力。目前PETSc已经成功应用于优化问题、生物医学、计算流体动力学等多类工程与科学计算问题。本文的数值实验国产某超级计算机上展开。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "5数值算例",
        "text_level": 1,
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "作为应用算例，我们对真实尺寸的深圳地王大厦附近约一平方公里区域进行高雷诺数大气流场进行计算，通过流场信息与并行性能两方面对算法进行评价。本节采用NKS算法所获取的结果与目前主流的商用计算流体力学软件CFX的计算结果进行对比来验证算法的正确性。为使模拟结果具有可比性且有对比价值，NKS算法与商业软件进行数值计算时均采用同样的几何模型、流体材料属性、计算区域、有限元网格以及初始与边界条件。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "5.1问题描述",
        "text_level": 1,
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "深圳市红岭南路、宝安南路路、滨河大道与红宝路所围成的约 $1 0 0 0 m { \\times } 1 0 0 0 m$ 区域包括多座深圳地标建筑，如地王大厦、京基大厦以及万象城等。本算例重构的几何模型包含了该区域大部分的高层建筑共计29 座，如图二所示。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "nlyn ",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "此外，在剖分网格时，为保证计算精度，生成的网格需涵盖所有建筑群的主要表面特征，即所谓的包面技术。包面技术在进行外流场计算时十分重要，是能够实现复杂模型外流场计算的关键所在。因此，网格在建筑物表面往往需要加密至极小。本文将包含建筑群在内的整体计算区域设置为$\\Omega = 4 0 0 0 m \\times 4 0 0 0 m \\times 8 0 0 m$ ，坐标原点位于京基大厦与地王大厦地面中心连线中点处。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "非结构四面体网格 $T ^ { h } = \\{ K \\}$ 的剖分是进行有限元计算的前提，在本算例中，通过商用软件ICEMCFD对计算区域 $\\Omega$ 进行非结构网格剖分，在划分网格时，我们对建筑物壁面等对流体运动影响较大区域进行加密处理。经剖分后，本算例的非四面体网格总数约为 $1 . 3 { \\times } 1 0 ^ { 7 }$ ，自由度约为 $D O F = 1 . 0 3 \\times 1 0 ^ { 7 }$ ，建筑物壁面网格尺寸达到米量级。算法的实现需要对计算区域即离散后的网格进行分区以使用区域分解方法构造适当的预条件子。通过调用开源软件包ParMETIS进行网格分区，一般分区的个数与处理器个数相等，且各个分区所计算的自由度个数近似相同以达到负载平衡，如图三所示，不同颜色的网格表示在不同处理器上计算，需要注意的是，本示意图并非将真实流体计算区域划分而是将建筑物作为固体区域划分以为更好展示并行分区概念。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "欢 ",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "大气流体取 $2 5 ^ { \\circ } \\mathrm { C }$ 标准大气压下的空气，其密度$\\scriptstyle \\mathcal { P } = 1 1 8 \\log ( m ^ { 3 } )$ ，动力粘度系数 $1 \\leq t \\leq 3 + 1 5 \\leq 4 \\leq 5 \\times \\frac { 1 } { 2 }$ ，设进□边界风速为：",
        "page_idx": 4
    },
    {
        "type": "equation",
        "text": "$$\nV _ { i n } = - ( \\frac { V _ { \\operatorname* { m a x } } } { 1 8 0 0 ^ { 2 } } ) t ^ { 2 } + ( 2 \\frac { V _ { \\operatorname* { m a x } } } { 1 8 0 0 } ) t  ,\n$$",
        "text_format": "latex",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "其中设 $V _ { \\operatorname* { m a x } } = 1 0 m / s$ ，时间步长 $\\Delta t = 4 . 0 s$ ，计算$1 8 0 0 s$ 内流场的变化情况。算法中的线性和非线性求解器的相对收敛误差分别取为 $1 0 ^ { - 4 }$ 和 $1 0 ^ { - 6 }$ 。分别取ur =10m/s为特征速度、H=50m为特征长度，计算雷诺数为：",
        "page_idx": 4
    },
    {
        "type": "equation",
        "text": "$$\n\\mathrm { R e } = \\frac { \\rho u _ { T } H } { \\mu } = \\frac { 1 . 1 8 5 k g / m ^ { 3 } \\times 1 0 m / s \\times 5 0 m } { 1 . 8 3 1 \\times 1 0 ^ { - 5 } k g / m s } = 3 . 2 3 6 \\times 1 0 ^ { 7 } \\mathrm { ~ o }\n$$",
        "text_format": "latex",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "作为对比参照结果，我们采用商业CFD软件ANSYS.CFX使用相同网格数、边界条件的问题进行数值模拟，获得的数值结果用于与本文算法获取的数值结果进行对比。在CFX中，瞬态项采用二阶向后Euler格式，均方根残差（RMS）收敛误差为 $1 0 ^ { - 5 }$ 。",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "5.2流场数值结果 ",
        "text_level": 1,
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "图四、图五所示为 $t = 1 8 0 0 s$ 时刻流场数值结果对比。从建筑物表面压力场与周围速度场分布来看，NKS算法获取的流场分布与ANSYS计算结果大致相同，在建筑物迎风面与背风面分别测定高压与低压；在建筑物之间的街道，空气流通多呈现高速及低速两种状态，如京基大厦附近空气流通速度较高，而不同，印证了由于建筑物尤其是高层建筑物的阻挡作用，在城市建筑群密集处会产生“急流”或“死",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "流”区域。",
        "page_idx": 4
    },
    {
        "type": "image",
        "img_path": "images/d979ed57fda0c10788bba829142d35ddfe4d05d6eff3a22e70b528fb998ce026.jpg",
        "img_caption": [
            "图四压力云图对比（左：ANSYS,右：NKS）",
            "图五 $z = 8 0 m$ 处速度场分布云图（左：ANSYS,右：NKS)"
        ],
        "img_footnote": [],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "SgF Om F ",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "急流区空气流动剧烈呈湍流状态，其运动状态十分复杂，如面流线图六所示，为空气污染扩散模拟等进一步分析带来了一定的困难。死流区域空气流速低，不利于空气污染物的扩散，导致污染物聚集形成高污染区域。因此，高精度的大气环境数值模拟可以更精确的获取城市某一小区域的空气运动状况，为未来小区级大气环境与质量差别化预报提供了技术手段。",
        "page_idx": 4
    },
    {
        "type": "image",
        "img_path": "images/0716d5382e2f8cdf4693f8b395a6ba5d26ad4b25ae66b3b48600b8bcd19b1557.jpg",
        "img_caption": [
            "图三计算网格剖分与区域分解示意图",
            "图六 截面 $z = 8 0 m$ 处面流线图"
        ],
        "img_footnote": [],
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "5.3并行可扩展性结果",
        "text_level": 1,
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "本小节给出基于NKS算法求解深圳城区大气环境的并行可扩展性数值结果。Newton非线性迭代与Krylov子空间方法线性迭代收敛误差分别设置为$1 0 ^ { - 6 }$ 和 $1 0 ^ { - 1 2 }$ ，数值结果取前20个时间步的平均值。",
        "page_idx": 4
    },
    {
        "type": "table",
        "img_path": "images/bf000f9f44994937e7932872510e67b741d979ef4052232d6993721356367c3b.jpg",
        "table_caption": [
            "表1NKS 算法的并行性能"
        ],
        "table_footnote": [],
        "table_body": "<html><body><table><tr><td rowspan=\"2\">np</td><td colspan=\"3\">ILU</td><td colspan=\"3\">LU</td></tr><tr><td>Newton</td><td>GMRES</td><td>Time</td><td>Newton</td><td>GMRES</td><td>Time</td></tr><tr><td>512</td><td>3.8</td><td>131.6</td><td>228.3</td><td></td><td>-</td><td></td></tr><tr><td>1024</td><td>3.8</td><td>134.4</td><td>139.5</td><td>3.8</td><td>89.9</td><td>1051.7</td></tr><tr><td>2048</td><td>3.8</td><td>143.3</td><td>93.2</td><td>3.8</td><td>114.2</td><td>351.2</td></tr><tr><td>4096</td><td>3.8</td><td>149.2</td><td>66.1</td><td>3.8</td><td>141.3</td><td>117.3</td></tr><tr><td>8192</td><td>3.8</td><td>154.2</td><td>42.7</td><td>3.8</td><td>168.2</td><td>60.1</td></tr><tr><td>16384</td><td>3.8</td><td>168.6</td><td>31.8</td><td>3.8</td><td>204.8</td><td>37.6</td></tr></table></body></html>",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "表1列出了采用ILU和LU方法作为线性求解器时，不同处理器条件下计算的可扩展并行数值结果。",
        "page_idx": 4
    },
    {
        "type": "text",
        "text": "Newton，GMRES和Time分别表示为每个时间步内非线性迭代次数、线性迭代次数以及计算时间（单位为秒)。为了更加清晰地展示可扩展性性能，本文将并行数值结果以加速比的形式列于图8中。",
        "page_idx": 5
    },
    {
        "type": "image",
        "img_path": "images/748c3dee40697258a18f0b55a1e38589401d474940197cca2bfc9c35a5743a90.jpg",
        "img_caption": [
            "图8每时间步平均计算时间与加速比"
        ],
        "img_footnote": [],
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "从并行测试结果我们可以看到，由于采用了前一时间步的结果作为初始值，每个时间步的非线性迭代次数Newton非常少，非线性迭代次数几乎与处理器个数无关。随着计算核数的增加，线性迭代次数GMRES略微增加。计算时间等并行数值结果显示我们的算法具有非常好的可扩展性，处理器个数达到万核时并行效率在 $30 \\%$ 左右，而采用LU算法作为子求解器时可获得超线性的加速比。",
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "6 结论 ",
        "text_level": 1,
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "对于城市大气环境模拟问题，高保真度往往意味着庞大的计算量，几何多尺度、高雷诺数等因素致使其求解非常具有挑战性，对计算机的硬件与算法都有极高的要求。寻求稳定、可扩展的高效并行数值算法以获取时效性强且可置信的数值结果是数值模拟的关键所在。基于国产大规模计算系统平台，本文通过对大规模非线性系统进行高效求解器和预处理技术的研究，提出一种可扩展并行Newton-Krylov-Schwarz算法。非线性方程采用非精确Newton方法进行求解，在每个Newton步，Jacobian系统通过基于区域分解方法的限制加性Schwarz预条件子处理，然后使用以GMRES方法为代表的Krylov子空间迭代法作为线性求解器进行求解。作为应用，我们对深圳地王大厦附近约一平方公里区域进行大气流场进行计算。数值结果显示，本文的算法在扩展至万核处理器平台时仍具有非常良好的可扩展并行性能，为未来对整个城市区域进行高精度（如网格分辨率达到米级，未知数个数达十亿量级）的大气环境模拟提供了一种可参考的算法。",
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "参考文献：",
        "text_level": 1,
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "[1]徐祥德，汤绪．城市化环境气象学引论．北京：气象出版社，2002.",
        "page_idx": 5
    },
    {
        "type": "text",
        "text": "[2]《北京城市规划建设与气象条件及大气污染 关系研究》课题组．城市规划与大气环境．北 京：气象出版社,2004.   \n[3] T. Baileyd. User's guide for the industrial sourcecomplex (ISC3） dispersion models revised volumeI, US:EPA,1995.   \n[4] D.J. Carruthers,A. M. Mckeown, D. J. Hall, et al. Validation of ADMS against wind tunnel data of dispersion from chemical warehouse fire.Atmos.Environ.，1999，33(12): 1937-1953.   \n[5] F.Chen.Developing an integrated urban modeling system for WRF. NCEP EMC Seminar, Camp Springs, 2005,18.   \n[6] 汪光煮，王晓云等．大气环境数值模拟在城 市小区规划中的应用．清华大学学报(自然科 学版),2006,46(9):1489-1494.   \n[7] A..Martilli. Currentresearchandfuture challenges in urban mesoscale modelling. Int. J. Climatol., 2007,27(14):1909-1918.   \n[8] E.Batchvarova,S.E.Gryning. Advances in urban meteorology modelling.Advances in Air Pollution Modeling for Environmental Security. Springer Netherlands,2005: 23-32.   \n[9] Knoll D and KeyesDE. Jacobian-free Newton-Krylovmethods:Asurvey of approaches and applications [J]. J. Comput. Phys.,2004,193: 357-397.   \n[10] Balay S,Buschelman K,Gropp WD,et al. PETSc Users Manual [R]. Argonne National Laboratory, 2016. ",
        "page_idx": 5
    }
]