[
    {
        "type": "text",
        "text": "激光共聚焦显微成像数据采集系统设计",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "薛晓君 张运海（中国科学院苏州生物医学工程技术研究所苏州215163）",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "摘要：激光共聚焦显微成像技术能够有效的排除非焦平面的信息，提高了光学显微成像的分辨率和对比度。针对激光共聚焦显微成像系统的点扫描成像过程，基于LabVIEW平台开发了数据采集系统，该系统不仅能够对数据进行采集，还能将数据准确的重建为图像并实时显示。数据采集系统采用生产者-消费者模型作为基础架构，通过两个同步信号分别实现了图像的帧同步和行同步，确保了重建图像的准确性。通过对生物样本进行试验，该系统能够将样本图像实时准确的显示出来，满足了整个显微成像系统的要求。",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "关键词：共聚焦；数据采集；生产者-消费者模型；图像实时显示中图分类号：TP274.2 文献标识码：A 国家标准学科分类代码：510.8040",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Data acquisition system design for laser scanning confocal microscopy imaging ",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Xue XiaojunZhang YunhaiHu BianTang Zhihao (SuzhouInstituteofBiomedicalEngineeringandTechnology(SBET),ChineseAcademyofSciences,Suzhou215163,China) ",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Abstract:Laser Scanning Confocal Microscopic(LSCM)isahighresolution microscopic imagingtechnology，whichuses the conjugatefocus thologdntsouelgtingcudingthoutoffocussignalsectielyancingteesotiodtrast. A data acquired system was developed basedonLabVIEWtoaimatthepointscaning imagingof laserscaning confocal microscopic imagingsystem.Thesystemnotonlyacquireddata,butalsoaccuratereconstructedthedataasanimageanddisplayedreal-time.The producer/consumermodelwaschosenastheinfrastructureof thesystem.Twosynchronous signalsrealizedtheframeandline synchronizationtoensuretheacuracyofthereconstructedimage.Bytestingof biologicalsamples,thesystem displayedtheimages accuracy and real-time, met the requirements of the microscopy imaging system. ",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "Keywords:confocal,data acquisition, producer/consumer model,image real-time display ",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "1引言",
        "text_level": 1,
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "长期以来，普通光学显微镜对于我们理解生物结构，揭示生命现象发挥了很大作用。随着免疫荧光技术在生物学研究领域的广泛应用，然而受光学衍射效应的限制，普通光学显微镜的分辨率已接近理论极限。因此，人们使用不同的方法来提高光学分辨率，激光共聚焦显微技术的出现在一定程度上实现了这一目的。与传统光学显微技术相比，激光共聚焦显微技术不仅能够提高成像分辨率和图像的对比度，还能够对样本进行层切扫描，实现对样本的三维成像。由于这些独特的优势，激光共聚焦显微技术不仅在生物医学基础研究和临床研究中得到了广泛的应用[1-2]，还在材料学领域得到了应",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "用[3]。",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "目前，虚拟仪器技术是测控领域最流行的技术之一[4-6]。虚拟仪器是将传统仪器与计算机软件技术充分结合起来，以实现并扩展传统仪器的功能。与传统仪器相比，虚拟仪器在智能化程度，处理能力，性价比和可操作性等方面具备明显的技术优势。美国NI公司的LabVIEW[7-8软件是目前虚拟仪器常用的开发软件，它的出现给虚拟仪器的设计和开发带来了很大便利。基于虚拟仪器的优点，本文使用LabVIEW虚拟仪器开发平台，设计开发了激光扫描共聚焦显微镜的数据采集系统。该系统与激光器，针孔，扫描振镜，显微物镜，光电倍增管等硬件一起构建了一套完整的激光共聚焦显微成像系统，实现了对荧光信号的实时采集，并将信号重建为图像实时显示出来，满足了整个系统的要",
        "page_idx": 0
    },
    {
        "type": "text",
        "text": "求。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "2 实验系统组成",
        "text_level": 1,
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "整个激光共聚焦显微成像实验系统由三部分组成，分别是：光学系统，电路控制系统和数据采集系统，其总体结构如图1所示。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "实验系统的工作过程如下：首先激光器发出激光，通过光学系统照射到样本上，激发样本产生荧光，荧光通过原光路返回，在二色镜处，荧光与激光被分开，然后荧光通过针孔进入光电倍增管，转换为电流信号，然后通过信号放大电路对信号进行放大并将信号转换为电压信号供数据采集卡采集，从而实现了单点的共聚焦成像。通过两个扫描振镜的运动控制光点的在焦平面上的位置来实现平面扫描成像的过程。一个扫描振镜进行横向扫描，称为X振镜，另一个扫描振镜进行纵向扫描，称为Y振镜。X振镜的速度决定了每秒中能扫描的行数，Y振镜的速度决定了每秒能扫描的帧数。X振镜与Y振镜速度的比值决定了每帧图像的行数。",
        "page_idx": 1
    },
    {
        "type": "image",
        "img_path": "images/c9e129e0a3c6dc1d673344a68566e857bb5dc22a47fbcdad86211018c1404189.jpg",
        "img_caption": [
            "图1系统组成结构框图，图中实线是电信号传输线路，虚线是激光传输线路，点线是荧光传输线路",
            "图2同步信号时序图，图中1处进行帧同步和第一个行"
        ],
        "img_footnote": [],
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "扫描振镜驱动电路提供两路振镜驱动信号，控制扫描振镜的运动，同时提供两路同步信号和采样时钟给数据采集卡，这样可以保证重建图像的准确性。实验系统中使用的数据采集卡是NI公司的PCI-6132，具有4个差分输入通道，14位的模拟输入分辨率，最大采样率2.5MS/s，支持外部触发和外部采样时钟。数据采集系统使用LabVIEW2011版进行编写，主要使用了其中的DAQ和IMAQ模块。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "3数据采集系统设计与实现",
        "text_level": 1,
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "数据采集系统的主要功能是数据采集，同时将数据准确的重建为图像并实时显示出来。整个系统可以分为两个模块：数据采集模块和图像显示模块。数据采集和图像显示都是一个不断循环的过程，而且数据采集得到的数据要传输到图像显示部分进行处理，为了避免出现数据的丢失，保证得到完整准确的数据，因此选用生产者-消费者模型作为软件的基本结构进行编程。生产者-消费者模型分为两个独立的循环：生产者循环和消费者循环，使用队列在两个循环之间进行数据传输。使用队列对生产者循环采集到的数据进行缓存，可以避免使用其他数据传输方式产生的竞争，重复和数据丢失等问题。生产者产生的数据放入队列的耗时极少，基本不影响数据采集的速度，避免了数据丢失出现的可能[]。消费者循环只需要从队列中读取数据就可以了，而不需要与生产者循环进行同步。在整个数据采集系统中，数据采集模块相当于生产者，图像显示模块相当于消费者。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "3.1数据采集模块设计",
        "text_level": 1,
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "在整个系统中，数据采集部分作为生产者不断的采集数据，将数据写入队列。同时还要保证重建图像的准确性。为了重建出准确的图像，需要数据采集程序准确的识别出每幅图像的开始和每行的开始。要实现这个功能，需要使数据采集过程与扫描振镜的运行相配合。需要对数据采集过程进行精确的控制。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "对数据采集过程的控制可以通过软件或者硬件的方法来实现。由于Windows系统是一个抢占式多任务操作系统，软件控制一般只能精确到1ms左右[10]。若使用软件方法不能满足精确采集数据的要求，因此只能使用硬件的方法来实现。硬件方法可以通过数据采集卡的触发机制来实现数据采集与振镜扫描运动的同步。为了能够控制每幅图像的开始和每行的开始，需要两个同步信号。在本实验系统中，同步信号由振镜驱动电路提供，控制每幅图像开始的信号称为帧同步信号，控制每行开始的信号称为行同步信号。帧同步信号与Y振镜的驱动信号对应，行同步信号与X振镜的驱动信号对应，各路信号的时序如图2所示。",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "X振镜 WW  \n驱动信号  \n行同步信号 门门/  \nY振镜  \n驱动信号  \n帧同步信号2",
        "page_idx": 1
    },
    {
        "type": "text",
        "text": "同步，2处进行第二行的同步，3处结束一幅图像的数据采集，",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "4处开始另一幅图像的采集",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "为了同时实现两路同步信号的触发，在系统中采用了开始触发（StartTrigger）和暂停触发（PauseTrigger）组合的方式。开始触发由帧同步信号来实现，控制一帧图像数据采集的开始；暂停触发由行同步信号来实现，控制一行数据采集的开始。数据采集卡通过检测帧同步信号的上升沿或者下降沿来实现开始触发。实验中是检测上升沿来实现触发的。数据采集卡通过检测行同步信号的电平高低来实现暂停触发。实验中，高电平时进行数据采集，低电平时暂停数据采集。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "由于本实验系统中使用的PCI-6132数据采集卡不支持重触发，开始触发只能触发一次，随着采集时间的延长，会导致帧同步不准确。为了准确的获取多幅图像数据，程序采用了每次启动一个有限点采样的数据采集任务，一个任务只采集一幅图像的数据。在采集任务内部，每循环一次读取一行的数据写入队列，循环次数由图像的行数决定。当一幅图像采集完成后，结束这个采集任务，重新创建一个新的采集任务。为了保证触发信号能够准确触发，振镜驱动信号在一幅图像扫描完后需要暂停一段时间再开始下一幅图像的扫描，等待软件中采集任务的重新初始化。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "在本系统中，采样率是由X振镜的速度和过采样率决定的，图像的刷新频率由Y振镜的速度决定。实验中X振镜的速度为 $1 0 0 \\mathrm { H z }$ ，Y振镜的速度为 $0 . 2 \\mathrm { H z }$ 。这样每秒获得100行的数据，5秒获得一整幅图像，图像为500行。在实验中，设定图像每行有500个像素，这样得到图像的大小为$5 0 0 ^ { * } 5 0 0$ 。每秒中的采样点数为50K，对应的采样率为 ${ 5 0 } \\mathrm { K H z }$ 。由于在每行扫描中，有一段时间暂停采集，因此实际的采样率要比 $5 0 ~ \\mathrm { K H z }$ 高。实际采用的采样率为 $6 0 \\mathrm { K H z }$ 。为了减小采样中随机噪声对图像质量的影响，在采样中加入了过采样，对信号进行均值滤波。由于数据采集卡PCI-6132的最大采样率为 $2 . 5 \\mathrm { M H z }$ ，因此采用了40倍过采样，对应的采样率为2.4MHz。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "3.2图像显示模块设计",
        "text_level": 1,
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "在整个数据采集系统中，图像显示模块作为消费者不断从队列中读取数据，对数据进行处理，实时显示图像。每循环一次读取图像中一行对应的数据。首先对数据进行均值滤波，然后进行灰度转换，将原始数据的电压值映射到灰度空间的0\\~255之间，映射关系如公式（1）所示：",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 2
    },
    {
        "type": "equation",
        "text": "$$\nG r a y = 2 5 5 * \\frac { V - V _ { \\operatorname* { m i n } } } { V _ { \\operatorname* { m a x } } - V _ { \\operatorname* { m i n } } }\n$$",
        "text_format": "latex",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "式中Gray表示转换后的灰度值，V表示当前点的电压值， $ { \\mathrm { \\Delta V _ { \\mathrm { m a x } } } }$ 表示电压的最大值， ${ \\bf V } _ { \\mathrm { m i n } }$ 表示电压的最小值。然后根据前面板的选择生成伪彩色数据。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "模块内部对对整个消费者循环进行计数，根据计数值和图像总行数计算出数据要写入到当前图像中的第几行，生成每行数据的写入坐标。整行数据写入图像后，对前面板进行刷新，这样图像就在前面板实时显示出来。当一幅图像的最后一行写入后，根据前面板的选择对图像进行保存，程序会自动生成图像的文件名，并将图像保存到用户指定的文件夹中。每次读取一行数据即可以保证采集到的数据能够及时被读出，避免被新数据覆盖，同时界面刷新的速度满足实时性的要求。每次读取一个点的数据的话，会导致采集到的数据不能及时取出，被新数据覆盖的情况。每次读取一帧图像的话，会出现图像刷新太慢，不满足实时显示图像的要求。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "图3是基于LabVIEW设计开发的数据采集系统的前面板。面板左侧是图像显示区域，对重建的图像进行实时显示，图像初始化灰度为0，因此还没有刷新到的区域是黑色的。图中显示的人表皮组织切片的激光共聚焦显微图像。面板右侧是数据采集的设置区域和信息显示区域。对过采样倍数，信号的极值范围，图像的颜色进行设置，同时显示已获取的图像数目，队列中的数据数目。",
        "page_idx": 2
    },
    {
        "type": "image",
        "img_path": "images/1afb36be616c8a48853ed5fee8e7d4e8c28701d99dc82b40cf5d64b388608fe2.jpg",
        "img_caption": [
            "图3程序运行时的前面板（人表皮组织切片)"
        ],
        "img_footnote": [],
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "4结果",
        "text_level": 1,
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "在数据采集系统设计完成后，与激光共聚焦显微系统的硬件一起分别对人表皮组织和老鼠肾脏切片进行扫描成像。实验系统采用的激光器的波长是 $4 8 8 \\mathrm { n m }$ ，扫描振镜是CTI公司的6215H，显微物镜的放大倍数是100倍。程序运行时的效果如图3所示。从图中显示的数据可以看出，队列中数据数目为0，表示采集到的数据能够被实时处理，而不会在队列中积压，达到了实时显示的效果。而且连续采集多幅图像，同步依然很准确，满足了整个系统的要求。",
        "page_idx": 2
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "在实现同步程序之前，我们还编写了没有进行同步的采集程序，将采集得到的图像与有硬件同步的图像进行对比，如图4所示。从图4中可以看出，具有硬件同步的程序可以准确的重建出图像，而没有硬件同步会导致程序无法判断图像的起始位置，只能根据每行的数据数目对采集到的数据进行截取，导致图像边界出现在重建图像的中间位置，在图像中出现一个“十字形”的图像边缘，无法得到正确的图像。",
        "page_idx": 3
    },
    {
        "type": "image",
        "img_path": "images/ef77f8365f839ab2a569444dae7b286af0a060ef9eeeec5071edda9a70755b11.jpg",
        "img_caption": [
            "图4有硬件同步和无硬件同步获得的图像对比（老鼠肾脏切片）左图为有硬件同步的图像，右图为无硬件同步的图像"
        ],
        "img_footnote": [],
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "5结论",
        "text_level": 1,
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "本文使用LabVIEW设计完成了激光共聚焦显微成像数据采集系统，与硬件系统一起组成了一个激光扫描共聚焦显微成像系统。该系统可以实时的得到扫描的图像数据并显示出来，满足了整个系统的需求。当前系统的扫描频率还不能随时改变，不能满足不同成像速度的要求，下一步将开发能够进行不同成像速度的数据采集系统就，满足成像速度可变的要求。",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "参考文献：",
        "text_level": 1,
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "[1]朱珊珊，黄志江．激光扫描共聚焦显微镜在生命科学研究中的应用[J]，《国外医学》麻醉学与复苏分册，2005，26(2):118-119.  \n[2]逢树龙，蔡振宇．激光扫描共聚焦显微镜在医学研究中的应用[J]，2009，9(13):2579-2580.  \n[3]刘东武，牟洪善．激光扫描共聚焦显微镜技术在材料学研究中的应用[J]，生命科学仪器，2006，4(10):11-13.  \n[4] 戴云，史国华，祁传琦．虚拟仪器技术在光学相干层析系统中的应用[J]．仪器仪表学报，2007，28（6)：1113-1116.  \n[5]王金，宋春燕，姜金辉．基于虚拟仪器技术的民机动态信号分析仪[J]，国外电子测量技术，2011，30(1):35-39.  \n[6]缪永生，黄晓晴.基于虚拟仪器的电视机自动检测系统[J],电子测量技术，2012，35(6):102-105.  \n[7]陈敏，汤晓安．虚拟仪器开发环境LabVIEW及其数据采集[J]，计算机工程与设计，2001，22(5):61-63.  \n[8]行鸿彦，黄敏松.基于labVIEW虚拟仪器的心电信号采集系统的设计[J]，电子测量与仪器学报，2008，22(5):107-111.  \n[9]唐进元，李松，邵文．基于LabVIEW生产者-消费者模式的齿轮传动振动测试系统[J]，机械传动，2011，35(1):5-7.  \n[10]张红民，吕晓华．占成等.基于的随机扫描成像系统高速时间同步方法[J]，仪器仪表学报，2007，28(3):404-407.",
        "page_idx": 3
    },
    {
        "type": "text",
        "text": "",
        "page_idx": 3
    }
]