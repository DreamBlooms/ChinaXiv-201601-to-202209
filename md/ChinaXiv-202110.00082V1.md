# A Simple Self-calibration Method for The Internal Time Synchronization of MEMS LiDAR

YU ZHANg,1 XIAOGUANG DI,² SHIYU YAN,1 BIN ZHANG,1 BAOLING QI,1 AND CHUNHUI WANG1,\*

l National Key Laboratory of Tunable Laser Technology, Harbin Institute of Technology, Harbin,150001,   
Heilongjiang, China,   
2ontrol and Simulation Center, Harbin Institute of Technology,Harbin,150o1, Heilongjiang,China   
\*wangch_hit@163.com

Abstract: This paper proposes a simple self-calibration method for the internal time synchronization of MEMS(Micro-electromechanical systems) LiDAR during research and development. Firstly,we introduced the problem of internal time misalignment in MEMS lidar. Then,a robust Minimum Vertical Gradient(MVG) prior is proposed to calibrate the time difference between the laser and MEMS mirror, which can be calculated automatically without any artificial participation or specially designed cooperation target. Finally,actual experiments on MEMS LiDARs are implemented to demonstrate the effectiveness of the proposed method. It should be noted that the calibration can be implemented in a simple laboratory environment without any ranging equipment and artificial participation, which greatly accelerate the progress of research and development in practical applications.

$\circledcirc$ 2021

# 1.Introduction

For most sensors,the calibrations of the intrinsic and extrinsic parameters are always necessary. With the development of camera and LiDAR technology,lots of calibration methods have been proposed, such as [1],[2],[3],[4],etc. However,most of these studies focus on improving the accuracy and convenience of calibration during the application stage,and few studies have reported methods to accelerate and facilitate the calibration process during research and development.

In a MEMS LiDAR system, we can define an entire scan period as one frame, then ideally, the laser and MEMS mirror should have the same frame frequency and the same start time and end time at every frame.However,the time differences between the laser and MEMS mirror in LiDAR exist in every frame's start and end time, even in each row of a frame of data.

Firstly,MEMS mirror and laser are two different subsystems.Although they can be triggered synchronously,there is often a specific time difference due to the different signal distances and device response time.That leads to a time difference $T _ { s }$ between the MEMS mirror and laser at the start of each frame,which will lead to obvious distortion of the point cloud generated by MEMS LiDAR,as shown in Fig. 1 (a).

At the same time,during the design, we first specify how many laser pulses a frame contains, and then formulate matching MEMS control signals. However,in the continuous scanning state, the actual response of the MEMS mirror is different from the theoretical value,which means the two independent control systems,MEMS mirror and laser, have different frame frequencies. That produces a time difference $T _ { e }$ at the end of each frame, which will cause cumulative distortion of the generated point cloud,as shown in Fig.1(b). Also,there is a misalignment between laser and MEMS mirror in each row of one frame data.For example,at design time,MEMS scanned from one side to the other with 45O laser pulses.However, more or fewer pulses will be due to the response differences when the MEMS mirror scans a row. The misalignment will cause severe distortion of the generated point cloud, as shown in Fig. 1(c). These time differences usually occur at the same time during the research and development process,as shown in Fig. 1(d).

During the research and development process, we must constantly adjust the device to match the MEMS mirror and the laser, which is quite tedious and time-consuming. In this paper, we provide a Minimum Vertical Gradient(MVG) prior which can be used to calibrate those time differences in MEMS LiDAR instead of artificial alignment like [5]. The MVG prior greatly speeds up our debugging speed in reality.

Our contributions can be summarized as:

·We propose a Minimum Vertical Gradient(MVG) prior for MEMS LiDAR,which is robust to ranging error and can be used to automatically calibrate the distortion of point cloud caused by the internal time difference between the laser and MEMS mirror. · The MVG prior is robust to ranging and azimuth error and can significantly accelerate research and development in practical applications. · The proposed method has been tested on real MEMS LiDARs designed by us.

The remainder of the paper is organized as follows.In section 2, we explained the internal time synchronization problem in MEMS LiDAR in detail. In section 3,the MVG prior and the calibration method are stated. The actual experiments on MEMS LiDARs are implemented to demonstrate the effectiveness of the proposed method in section 4. Section 5 concludes this paper and discusses the future research directions.

![](images/68dac62f00142f96a6fda5dbfb8aaf25d4d4e9e0394febda9b9a06ff2b240907.jpg)  
Fig.1.The distortions caused by the time differences between the MEMS mirror and the laser. (a) Distortion caused by $T _ { s }$ .(b)Distortion caused by $T _ { s } + T _ { e }$ .(c)Distortion caused by misalignment in each row.(d) Combination of all distortions.(e)Without distortion.

# 2. MEMSLiDARand Internal Time Synchronization

Typically, there are two kinds of LiDAR configuration, one is bi-static configuration,and the other is mono-static.The main difference between those two kinds of lidar is the number of antennas [6]. Although the mono-configuration LiDAR has only one antenna to transmit and receive the pulse, which can save more space in LiDAR, it needs a more complex design than the bi-static one. Fig.2 shows the structure of a bi-static configuration MEMS LiDAR,and the LiDAR equipment used in our experiment also adopts this structure. It can be seen that the MEMS LiDAR contains a two-dimensional rotating MEMS mirror and a laser transmitter. Through the MEMS mirror, the laser pulse can be deflected to different azimuths to realize the measurementof three-dimensional information.

The output information of MEMS LiDAR usually includes azimuths and measured distances The measured distances are calculated through the TOF(Time Of Flight) method, which can be expressed as follows:

$$
R = c * \frac { t _ { e } - t _ { t } } { 2 }
$$

where $t _ { e }$ and $t _ { t }$ represent the actual time of the echo pulse and transmitted pulse,respectively, $c$ represents the speed of light $( c = 3 0 c m / n s$ for all the equations in this paper). The azimuths information can be calculated through the predetermined MEMS scanning path [7]. We can regard azimuths and ranging distances as two periodic sequences,and one period contains one frame of data. The premise of the internal parameter correction [8,9] in the application phase is that these two sequences correspond accurately. However, during research and development, those two sequences often do not correspond to each other in the start and end of every period, and even period time.

For example,as shown in Fig.2 and Fig.3, the laser and MEMS mirror can share the same synchronization(sync.） signal, but in fact, they have different response time, which willproduce a time difference $T _ { s }$ between the MEMS mirror and laser at the scanning start of every frame(Usually, MEMS mirror requires a longer response time). $T _ { s }$ will produce a mismatch between the azimuth and the measured distance, which will produce serious distortion in the point cloud(e.g.,Fig.l(a)). In mechanical LiDAR,there are also time differences between the motor and the lasers.However, it will only cause the yaw azimuth shift of the point cloud, which can be easily solved by external parameters calibration with known objects. As far as we know,there is no previous research focusing on calibrating this time difference automatically. In [5],an artificial time alignment method is provided, that is,artificially match the received distance signals and pre-designed azimuth through moving the distance signals one by one and observe whether the imaging results match the scene. However,this method is time-consuming,and the time difference changes a lot when the scanning path or angle changes.

Also,during LiDAR scanning,the MEMS mirror is in continuous motion,and the response of the MEMS mirror is not entirely consistent with the control signals. Then, the actual value of the frame frequency is different from the theoretical value,which will cause the time difference $T _ { e }$ at the end of the frame. As shown in Fig.3, $T _ { e }$ will accumulate to the $T _ { s }$ of the next frame and make the distortions in next frame changing allthe time. Typically, we must constantly adjust the MEMS control signals to make the MEMS mirror and laser have the same frame frequency. However, this is usually very difficult because we can only judge by comparing the actual scene and the point cloud image manually. Also,the different frame frequencies mean that the number of given azimuth and ranging information is not aligned. This further exacerbates the difficulty of the manual adjustment method. We need to manually align the start and end of each frame and each row of data to determine whether the MEMS mirror and laser are aligned accurately. In practice, we must reduce the scanning frame rate to ensure the distortion is not severe enough. Otherwise,the manual correction will be challenging to achieve.However, the distortions under different scanning frame rates are also different, so we cannot use the correction results at low scanning frame rates to replace high-speed conditions.

![](images/043b62a6c45d30d2c6224d98055111f96628be88b79dc8fe87ded9aac5399986.jpg)  
Fig.2.A typical structure of MEMS scanning LiDAR.The blue line represents the reference beam,the red line represents the measurement beam.The abbreviated information in the figure are:Avalanche PhotoDiode(APD),Constant Fraction Discrimination (CFD), Time to Digital Convert(TDC)

![](images/6bb7c6b2b1ddf6f0636046ef3ca9fbb55804c8ab736e8a6c0d99f6bc68d534e8.jpg)  
Fig.3.Schematic diagram of the internal timing of the LiDAR. $T _ { s }$ represents the start time difference between MEMS mirror and laser in one frame.When the frame frequencies of MEMS mirror and laser are different, $T _ { s }$ will continue to change over time.

# 3.Methods

# 3.1. Self-calibration of time difference between laserand MEMS mirror

To avoid the complex artificial procedure during calibration,and inspired by the total variation (TV) loss [1O] which is often used in low-level computer vision tasks,we propose a Minimum Vertical Gradient(MVG) prior to automatically calibrate the distorted point cloud.The TV loss is usually used to restrain noises,and treats the gradient as the total variation. It was proposed that the noisy images have higher total variation than clear images. The TV loss $J$ in an image can be expressed as follows:

$$
J _ { T V } = \sum _ { i = 1 } ^ { n } { \sqrt { \left( { \frac { \partial u _ { i } } { \partial x } } \right) ^ { 2 } + \left( { \frac { \partial u _ { i } } { \partial y } } \right) ^ { 2 } } }
$$

where, $\frac { \partial u _ { i } } { \partial x }$ and $\frac { \partial u _ { i } } { \partial y }$ e $i$ in image, Diferent from the TV loss,in the MVG prior,only the vertical gradients are used. And the vertical gradient is defined on a Polar coordinate system $( \theta , \phi , R )$ ,where $\scriptstyle \theta , \phi , R$ represent the horizontal azimuth, vertical azimuth,and ranging distance,respectively. The relationship between $( \theta , \phi , R )$ and the Cartesian coordinate system $( x , y , z )$ can be expressed as Equation 3:

$$
\begin{array} { l } { z = \frac { R } { \sqrt { 1 + t a n ^ { 2 } ( \theta ) + t a n ^ { 2 } ( \phi ) } } } \\ { y = z \ast t a n ( \phi ) } \\ { x = z \ast t a n ( \theta ) } \end{array}
$$

When the MEMS mirror scans raster like Fig.4, the goal is to make the sequences of the measured distances and azimuths have the same starting,turning,and ending points,and the misalignment at those points will lead to the three time differences between laser and MEMS mirror, respectively. The two sequences after registration can be expressed as

$$
R _ { i + m } ( \theta _ { i } ^ { k } , \phi _ { i } ^ { k } )
$$

where $m$ represents the num of pulses in the time difference $T _ { s }$ at the start of every frame(e.g., $T _ { s }$ in Fig. 3). $k$ represents the number of pulses corresponding to one row of raster that the MEMS mirror scans. $i$ represents the $i ^ { t h }$ point in sequences.

Then the MVG prior can be expressed as follows:

$$
J _ { M V G } = { \underset { m , k } { m i n } } \sum _ { i = 1 } ^ { n - m } { \lvert \frac { \partial R _ { i + m } ( \theta _ { i } ^ { k } , \phi _ { i } ^ { k } ) } { \partial \phi _ { i } ^ { k } } \rvert }
$$

From Equation 5,we can get $m$ and $k$ for each frame of data.Then $T _ { s }$ can be calculated through the folloing equation:

$$
T _ { s } = \Delta T * m
$$

where $\Delta T$ represents the time interval between two pulses.When the MEMS control signals are not modified, the value of $k$ is stable.However,it can be seen in Fig.3,due to the different frame frequency between MEMS mirror and laser, $m$ will change over time. Therefore,we can denote $m$ as $m ( t _ { j } )$ ,where $t _ { j }$ represents the $t _ { j }$ frame of ranging data. Also, in Fig. 3, it can be seen that the time differences $T _ { e }$ caused by frame asynchrony will accumulate to $m ( t _ { j } )$ , so it can be calculated from

$$
T _ { e } = \frac { \Delta T } { n - 1 } \sum _ { j = 1 } ^ { n - 1 } | m ( t _ { j + 1 } ) - m ( t _ { j } ) |
$$

After getting $T _ { e }$ ,we can easily modify the control signals of the MEMS mirror in the position reset phase(e.g., the red part of Fig.4).

# 4.Experiments

To evaluate the effectiveness and accuracy of the proposed method, we verify the method on MEMS LiDARs designed and built by ourselves.A fiber pulse laser with a pulse width of $4 n s$ is adopted,and the transmitted pulse is split into measurement and reference beam with a splitting ratio of $9 5 / 5$

![](images/1b0c6140e4e1bbf98a691b10b87e2086fad03dfb12b1de17ec53ef2269e6f4e4.jpg)  
Fig.4.MEMS scanning path. During the scanning process,in each frame,the MEMS mirror needs to be started from the same position,then it is needed to reset the MEMS position every frame.

![](images/33e5c75c4fdb21658c8fc614f88885601fbef4bc262bc8fed1bf9a50db840dde.jpg)  
Fig.5.The calibration result with MVG prior. (a) The image of the scanned scene. (b) Raw point cloud collected by LiDAR.(c) The MVG prior, $\mathrm { \Delta X }$ -axis represents the number of pulses in $T _ { s }$ ,Y-axis represents the real number of pulses in each row of the data.(d) the calibration result.

![](images/c718186c8207d8e356b95469cafde7b9aa3f06833f319964d49bfc5da470e445.jpg)  
Fig.6.The influence and calibartion of $T _ { e }$ .(a) The 2th frame of raw point cloud data. (b) The 318th frame of raw point cloud data. (c) $\mathbf { m }$ in $T _ { s }$ changes with the frame cause by $T _ { e }$ .(d) The point cloud after calibration

As shown in Fig.5(b), the raw point cloud of LiDAR is highly distorted,and it is hard to identify the objects in the scene.However, with the MVG prior, as shown in Fig.5(c) and (d), we can easily get the numbers of pulses in $T _ { s }$ and each row of the data. If with the manual-based method, we may need to proofread thousands of possible calibrated point clouds for one frame of data.

Fig.6 shows the influence and calibartion of $T _ { e }$ ． As shown in Fig.6(a) and (b), due to the existence of $T _ { e }$ ,the distortion of the original point cloud data has been changing.However, with the MVG prior we can easily estimate the $T _ { e }$ and increase the accuracy of $T _ { e }$ to sub-pulse(e.g., Fig.6(c)).

To evaluate the robustness of the MVG prior, we also test the method in different devices, with different object poses and distances,and with different scanning angles of the MEMS mirror. All the self-calibration results are in line with the real scene.Fig.7 and Fig.8 are tested on an early designed device. In this device,to avoid serious distortion in the case of high frame rates, the MEMS mirror scans at a very low speed(only 1.5 frames per second),and the only time difference between the laser and MEMS mirror is $T _ { s }$ . Fig.7 shows the MVG prior with the tilted target, and Fig.8 shows the MVG prior when we change the scanning angle and target's distance. It can be seen that the MVG prior works well with those situations.Also, it should be noted that after applying the MVG prior,the scanning frame rate of the newly designed device is very easily increased to 10.84 frames per second.

# 5. Conclusion

In this paper, to speed up research and development and reduce manual works, we propose a robust and straightforward automatic calibration method for the internal time synchronization of MEMS LiDAR.Compared with the manual calibration methods,our method is faster and more convenient. The MVG prior can greatly improve the speed of research and development of MEMS lidar with a high scanning frame rate and variable scanning angle. Our future work will explore how to further improve the scanning angle and detection range of MEMS LiDAR.

![](images/280662a78476da4f9de63e64b6ca788dc287db6a8d8149f51baa7d441db14197.jpg)  
Fig.7.The self-calibration of time difference between laser and MEMS mirror.(a) Scenes scanned by lidar.(b） The MVG prior.(c） Before calibration．(d) After calibration.

![](images/a10298a5fa9146a241d382c500c8b8c840f3b7846f2d13deda2888704d765de4.jpg)  
Fig.8.The self-calibration of time difference between laser and MEMS mirror.(a) Result of smaller scanning angle and different scanning angle has time different between laser and MEMS mirror.(b) Calibration result of (a).(c) Result of longer scanning distance.(d) Calibration result of (c).

Funding.National Natural Science Foundation of China (61775O48); Shenzhen Fundamental Research Program (JCYJ2020109150808037); National Key Scientific Instrument and Equipment Development Projects of China (62027823).

Disclosures. The authors declare no conflicts of interest.

Data Availability Statement.Data underlying the results presented in this paper are not publicly available at this time but may be obtained from the authors upon reasonable request.

# References

1.Z.Zhang,“Aflexible new technique forcameracalibration,”IEEE Transactions onPaternAnalysis Mach.Intell.22, 1330-1334 (2000).   
2.Q.Liao,Z.Chen,Y.Liu,Z.Wang,and M.Liu,"Extrinsic calibrationof lidar and camera with polygon,"in 2018 IEEE International Conference on Robotics and Biomimetics(ROBIO),(2018),pp.200-205.   
3．X.Zuo,P.Geneva,W.Lee,Y.Liu,andG.Huang,“Lic-fusion: Lidar-inertial-cameraodometryin2ol9IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS),(IEEE,2019),pp.5848-5854.   
4.X. Zuo,Y.Yang,P.Geneva,J.Lv,Y.Liu, G.Huang,and M.Polefeys,“Lic-fusion 2.O:Lidar-inertial-camera odometrywith sliding-window plane-feature tracking,’in2O2O IEEE/RSJInternational Conferenceon Intellgent Robots and Systems(IROS),(IEEE,202O),pp.5112-5119.   
5.X.Le,“Researchon key technologies of MEMS-based large scanning laser 3d image sensor”Ph.D.thesis,Harbin Institute of Technology (2017).   
6.R.D.Richmond and S.C.Cain,Direct-detection LADAR systems,vol.1(SPIE Press Bellingham,2010).   
7.D.Luo,“Prototype design of 3d lidar system based on mems mirror scannin,”Ph.D.thesis,Huazhong Universityof Science and Technology (2019).   
8.P.Garcia-Gomez,S.Royo,N.Rodrigo,andJ.R.Casas,“Geometric model and calibration method for a solid-state lidar, Sensors 20,2898 (2020).   
9.J.Wang,G.Zhang,and Z.You,“Ukf-based mems micromirror angle estimation for lidar”J.Micromechanics Microengineering 29,035005 (2019).   
10.L.I.Rudin,S.Osher,andE.Fatemi,“Nonlineartotalvariation based noiseremoval algorithms,”Phys.D:nonlinear phenomena 60,259-268 (1992).